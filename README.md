# InverceMatrixIP

PYNQ ボード上で動作する逆行列計算IPを作成してみました。
行列のサイズは 2x2 または 3x3 で、それぞれ異なるIP となっています。

The inverse matrix IPs which run on PYNQ board.
The size of the matrix is 2x2 or 3x3 only, each one is a different IP.

アルゴリズムは QR分解と後退代入によって逆行列を計算しています。
QR分解はGivens Rotation で行っています。

The algorithm is QR decomposition and back substitution.
QR decomposition is done by Givens Rotation.

回路構成は Systolic array で各セルは AXI4-Stream を用いて通信しています。

The circuit architecture is Systolic array, and each cell communicates by AXI4-Stream.

データは16bitの固定小数点で、小数部が8bit、整数部が符号も含めて8bitとなっています。

The data is a 16 bits fixed-point, the decimal part is 8 bits,
and the integer part is 8 bits including a sign bit.

今の所オーバーフロー（起きた場合はラップアラウンドする）や、正則でない
行列への対応などはありません。

For now, I'm not deal with overflow issue (wrap around if that happens)
and if the matrix is singular, no error status is returned.

とりあえず PYNQ で動かしてみるには
pynq ディレクトリにあるファイルを PYNQ ボード上にコピーして、
testInverceMatrix.ipynb を Jupyter Notebook で開いてください。
上から順番にCellを実行すれば、動作確認できます。

For trying the IPs on PYNQ board,
copy the files in the pynq directory to the PYNQ board,
open testInverceMatrix.ipynb by the Jupyter Notebook.
You can check them by executing Cell in order from the top.

IPの本体は vivado/2017.2/ip_repo/ ディレクトリの
InverceMatrix2 と InverceMatrix3 です。それぞれ 2x2, 3x3 の行列に対応しています。
ip_repo にある他の IP は InverceMatrix2, InverceMatrix3 を作るためのサブモジュールです。
PYNQボード(Zynq)で動作確認していますが、他のXILINXのFPGAでも動作するはずです。
但し確認はしていません。

IPs are InverceMatrix2 and InverceMatrix3 in the vivado/2017.2/ip_repo/ directory.
They correspond to 2x2, 3x3 matrix respectively.
The other IPs in ip_repo are submodules for creating InverceMatrix2 and InverceMatrix3 IPs.
I have checked the IPs with the PYNQ board(Zynq), but they should work with other XILINX FPGAs
even I haven't check them though.

pynq ディレクトリ下のファイルや IP 、Vivadoプロジェクトを作成するには、
vivado/2017.2 ディレクトリで
```
make clean
make
```
として下さい。
対応している Vivado のバージョンはディレクトリ名を見れば分かる通り 2017.2 です。
今の所ちゃんとmakefileを作っていないので、`make clean` をしないと失敗する場合があります。

To create files in the pynq directory, IPs and Vivado projects,
In the vivado/2017.2 directory, do
```
make clean
make
```
The corresponding Vivado version is 2017.2 as you can see in the directory name.
Since I haven't made makefile properly for now, it may fail if you don't do `make clean`.

PYNQ に載せる bitファイルと tclファイルを作成するプロジェクトは
vivado/2017.2/PYNQ/ ディレクトリの
PynqInverceMatrix2, PynqInverceMatrix3 にあります。

The projects which create the bit and tcl files for PYNQ board
are PynqInverceMatrix2, PynqInverceMatrix3 in the vivado/2017.2/PYNQ/ directory.

各IP を作成するプロジェクトは
vivado/2017.2/module/ ディレクトリの下にあります。

The projects that creates each IP are under the vivado/2017.2/module/ directory.

## License

Copyright 2017 kino2718

Vivadoが自動生成したファイルを除いた私が作成したファイルは
License は [MIT License](https://choosealicense.com/licenses/mit/) とします。

The files I created, excluding the files automatically generated by Vivado
are licensed under [MIT License](https://choosealicense.com/licenses/mit/).